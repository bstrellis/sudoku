<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Sudoku for Lovers</title>
    <!-- Not present in the tutorial. Just for basic styling. -->
    <link rel="stylesheet" href="css/base.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.1.0/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.1.0/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.16/browser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
  </head>
  <body>
    <div id="content"></div>
    <script type="text/babel">
      var MotherBox = React.createClass({
        getInitialState: function() {
          return {
            numsInRows: this.populateRows()
          };
        },

        populateRows: function() {
          var actualNumsInRows = [];
          for (var t = 0; t < 9; t++) {
            actualNumsInRows.push([]);
          }

          for (var i = 0; i < 9; i++) {
            var usedNums = [];
            for (var k = 0; k < 9; k++) {
              var num = this.generateNewNum(actualNumsInRows, usedNums, i, k);
              actualNumsInRows[i][k] = num;
              usedNums.push(num);
            }
          }

          return actualNumsInRows;
        },

        generateNewNum: function(gridArr, numsInRow, rowIndex, colIndex) {
          var num = Math.ceil(Math.random() * 9);
          var isDuplicate = this.numIsDuplicate(num, gridArr, rowIndex, colIndex);
          return isDuplicate ?
                 this.generateNewNum(gridArr, numsInRow, rowIndex, colIndex) :
                 num;
        },

        numIsDuplicate: function(num, gridArr, rowIndex, colIndex) {
          var columnArray = this.getColumn(gridArr, colIndex);
          if (columnArray.indexOf(num) !== -1) {
            return true;
          }

          var rowArray = this.getRow(gridArr, rowIndex);
          if (rowArray.indexOf(num) !== -1) {
            return true;
          }

          var squareArray = this.getSquare(gridArr, rowIndex, colIndex);
          if (squareArray.indexOf(num) !== -1) {
            return true;
          }

          return false;
        },

        getColumn: function (gridArray, colIndex) {
          var columnArray = [];
          for (var rowIndex = 0; rowIndex < gridArray.length; rowIndex++) {
            columnArray.push(gridArray[rowIndex][colIndex]);
          }

          return columnArray;
        },

        getRow: function (gridArray, rowIndex) {
          return gridArray[rowIndex];
        },

        getSquare: function (gridArray, rowIndex, colIndex) {
          var squareArray = [];
          var firstIncrementToSquare = 0

          var rowStartingIndex = 0;
          var rowEndingIndex = 0;
          var colStartingIndex = 0;
          var colEndingIndex = 0;

          if (rowIndex %)

          switch(squareIndex) {
            case 0:
              rowStartingIndex = 0;
              rowEndingIndex = 3;
              colStartingIndex = 0;
              colEndingIndex = 3;
              break;
            case 1:
              rowStartingIndex = 3;
              rowEndingIndex = 6;
              colStartingIndex = 0;
              colEndingIndex = 3;
              break;
            case 2:
              rowStartingIndex = 6;
              rowEndingIndex = 9;
              colStartingIndex = 0;
              colEndingIndex = 3;
              break;
            case 3:
              rowStartingIndex = 3;
              rowEndingIndex = 6;
              colStartingIndex = 0;
              colEndingIndex = 3;
              break;
            case 4:
              rowStartingIndex = 3;
              rowEndingIndex = 6;
              colStartingIndex = 3;
              colEndingIndex = 6;
              break;
            case 5:
              rowStartingIndex = 3;
              rowEndingIndex = 6;
              colStartingIndex = 6;
              colEndingIndex = 9;
              break;
            case 6:
              rowStartingIndex = 6;
              rowEndingIndex = 9;
              colStartingIndex = 0;
              colEndingIndex = 3;
              break;
            case 7:
              rowStartingIndex = 6;
              rowEndingIndex = 9;
              colStartingIndex = 3;
              colEndingIndex = 6;
              break;
            case 8:
              rowStartingIndex = 6;
              rowEndingIndex = 9;
              colStartingIndex = 6;
              colEndingIndex = 9;
              break;
          }

          for (var rowIndex = rowStartingIndex; rowIndex < rowEndingIndex; rowIndex++) {
            for (var colIndex = colStartingIndex; colIndex < colEndingIndex; colIndex++) {
              squareArray.push(gridArray[rowIndex][colIndex]);
            }
          }
          console.log('squareArray', squareArray);
          return squareArray;
        },

        transcribeRowsToColumns: function() {
          var numsInRows = this.state.numsInRows;
          var numsInColumns = [];
          for (var m = 0; m < 9; m++) {
            numsInColumns.push([]);
            continue;
          }

          for (var i = 0; i < 9; i++) {
            for (var k = 0; k < 9; k++) {
              numsInColumns[k][i] = numsInRows[i][k];
            }
          }

          return numsInColumns;
        },

        transcribeRowsToSquares: function() {
          var numsInRows = this.state.numsInRows;
          var numsInSquares = [];
          for (var m = 0; m < 9; m++) {
            numsInSquares.push([]);
            continue;
          }

          for (var i = 0; i < 9; i++) {
            for (var k = 0; k < 9; k++) {
              if (i < 3 && k < 3) {
                numsInSquares[0].push(numsInRows[i][k]);
              } else if (i < 6 && k < 3) {
                numsInSquares[1].push(numsInRows[i][k]);
              } else if (i < 9 && k < 3) {
                numsInSquares[2].push(numsInRows[i][k]);
              } else if (i < 3 && k < 6) {
                numsInSquares[3].push(numsInRows[i][k]);
              } else if (i < 6 && k < 6) {
                numsInSquares[4].push(numsInRows[i][k]);
              } else if (i < 9 && k < 6) {
                numsInSquares[5].push(numsInRows[i][k]);
              } else if (i < 3 && k < 9) {
                numsInSquares[6].push(numsInRows[i][k]);
              } else if (i < 6 && k < 9) {
                numsInSquares[7].push(numsInRows[i][k]);
              } else {
                numsInSquares[8].push(numsInRows[i][k]);
              }
            }
          }

          var numsInTopThreeSquares = [numsInSquares[0],
                                       numsInSquares[1],
                                       numsInSquares[2]];
          var numsInMiddleThreeSquares = [numsInSquares[3],
                                          numsInSquares[4],
                                          numsInSquares[5]];
          var numsInBottomThreeSquares = [numsInSquares[6],
                                          numsInSquares[7],
                                          numsInSquares[8]];

          numsInSquares = [numsInTopThreeSquares,
                           numsInMiddleThreeSquares,
                           numsInBottomThreeSquares];

          return numsInSquares;
        },

        render: function() {
          var numsInColumns = this.transcribeRowsToColumns();
          var numsInSquares = this.transcribeRowsToSquares();

          return (
            <div className="mother-box">
              <Row numsInThisRow={this.state.numsInRows[0]}
                   numsInColumns={numsInColumns}
                   numsInSquares={numsInSquares[0]}/>
              <Row numsInThisRow={this.state.numsInRows[1]}
                   numsInColumns={numsInColumns}
                   numsInSquares={numsInSquares[0]}/>
              <Row numsInThisRow={this.state.numsInRows[2]}
                   numsInColumns={numsInColumns}
                   numsInSquares={numsInSquares[0]}/>
              <Row numsInThisRow={this.state.numsInRows[3]}
                   numsInColumns={numsInColumns}
                   numsInSquares={numsInSquares[1]}/>
              <Row numsInThisRow={this.state.numsInRows[4]}
                   numsInColumns={numsInColumns}
                   numsInSquares={numsInSquares[1]}/>
              <Row numsInThisRow={this.state.numsInRows[5]}
                   numsInColumns={numsInColumns}
                   numsInSquares={numsInSquares[1]}/>
              <Row numsInThisRow={this.state.numsInRows[6]}
                   numsInColumns={numsInColumns}
                   numsInSquares={numsInSquares[2]}/>
              <Row numsInThisRow={this.state.numsInRows[7]}
                   numsInColumns={numsInColumns}
                   numsInSquares={numsInSquares[2]}/>
              <Row numsInThisRow={this.state.numsInRows[8]}
                   numsInColumns={numsInColumns}
                   numsInSquares={numsInSquares[2]}/>
            </div>
          );
        }
      });

      var Row = React.createClass({
        render: function() {
          return (
            <div className="row">
              <Cell numInCell={this.props.numsInThisRow[0]}
                    numsInThisRow={this.props.numsInThisRow}
                    numsInThisColumn={this.props.numsInColumns[0]}
                    numsInThisSquare={this.props.numsInSquares[0]}/>
              <Cell numInCell={this.props.numsInThisRow[1]}
                    numsInThisRow={this.props.numsInThisRow}
                    numsInThisColumn={this.props.numsInColumns[1]}
                    numsInThisSquare={this.props.numsInSquares[0]}/>
              <Cell numInCell={this.props.numsInThisRow[2]}
                    numsInThisRow={this.props.numsInThisRow}
                    numsInThisColumn={this.props.numsInColumns[2]}
                    numsInThisSquare={this.props.numsInSquares[0]}/>
              <Cell numInCell={this.props.numsInThisRow[3]}
                    numsInThisRow={this.props.numsInThisRow}
                    numsInThisColumn={this.props.numsInColumns[3]}
                    numsInThisSquare={this.props.numsInSquares[1]}/>
              <Cell numInCell={this.props.numsInThisRow[4]}
                    numsInThisRow={this.props.numsInThisRow}
                    numsInThisColumn={this.props.numsInColumns[4]}
                    numsInThisSquare={this.props.numsInSquares[1]}/>
              <Cell numInCell={this.props.numsInThisRow[5]}
                    numsInThisRow={this.props.numsInThisRow}
                    numsInThisColumn={this.props.numsInColumns[5]}
                    numsInThisSquare={this.props.numsInSquares[1]}/>
              <Cell numInCell={this.props.numsInThisRow[6]}
                    numsInThisRow={this.props.numsInThisRow}
                    numsInThisColumn={this.props.numsInColumns[6]}
                    numsInThisSquare={this.props.numsInSquares[2]}/>
              <Cell numInCell={this.props.numsInThisRow[7]}
                    numsInThisRow={this.props.numsInThisRow}
                    numsInThisColumn={this.props.numsInColumns[7]}
                    numsInThisSquare={this.props.numsInSquares[2]}/>
              <Cell numInCell={this.props.numsInThisRow[8]}
                    numsInThisRow={this.props.numsInThisRow}
                    numsInThisColumn={this.props.numsInColumns[8]}
                    numsInThisSquare={this.props.numsInSquares[2]}/>
            </div>
          )
        }
      });

      var Cell = React.createClass({
        getInitialState: function() {
          return {
            value: '',
            note: false
          };
        },

        handleClick: function (event) {
          if (event.shiftKey) {
            this.setState({ note: !this.state.note });
          }
        },

        handleTyping: function (event) {
          var isDuplicate = false;
          for (var i = 0; i < 9; i++) {
            if (parseInt(event.target.value) === this.props.numsInThisRow[i] ||
                parseInt(event.target.value) === this.props.numsInThisColumn[i] ||
                parseInt(event.target.value) === this.props.numsInThisSquare[i]) {
              isDuplicate = true;
            }
          }

          var style = {};
          if (isDuplicate) {
            style = {
              backgroundColor: "red"
            };
          } else if (this.state.note) {
            style = {
              color: "blue"
            };
          } else {
            style = {
              color: "black",
              fontSize: "30px"
            };
          }

          this.setState({
            style: style,
            value: this.state.note ?
                   event.target.value.substr(0, 9) :
                   event.target.value.substr(0, 1)
          });
        },

        render: function() {
          return (
            <input
                className="cell"
                type="text"
                placeholder={this.props.numInCell}
                value={this.state.value}
                style={this.state.style}
                onClick={this.handleClick}
                onChange={this.handleTyping}/>
          );
        }
      });

      ReactDOM.render(
        <MotherBox />,
        document.getElementById('content')
      );
    </script>
  </body>
</html>
